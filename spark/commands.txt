-- create operators --

helm repo add stackable-stable https://repo.stackable.tech/repository/helm-stable/
helm repo update

kubectl create namespace stackable

helm install -n stackable commons-operator stackable-stable/commons-operator --version 23.7.0
helm install -n stackable secret-operator stackable-stable/secret-operator --version 23.7.0
helm install -n stackable spark-k8s-operator stackable-stable/spark-k8s-operator --version 23.7.0


-- create minio --

helm install -n stackable minio oci://registry-1.docker.io/bitnamicharts/minio --set service.type=NodePort --set defaultBuckets=spark-logs --set auth.rootUser=admin --set auth.rootPassword=password --set tls.enabled=false --set tls.autoGenerated=true


-- configure spark --

kubectl apply -f spark-configurations.yaml -n stackable


-- spark history server --

kubectl apply -f spark-history-server.yaml -n stackable


-- create jobs --

kubectl apply -f spark-application.yaml -n stackable


-- clean up --

kubectl delete -f spark-application.yaml -n stackable

kubectl delete -f spark-configurations.yaml -n stackable

kubectl delete -f spark-history-server.yaml -n stackable

helm uninstall -n stackable commons-operator
helm uninstall -n stackable secret-operator
helm uninstall -n stackable spark-k8s-operator

helm uninstall -n stackable minio

kubectl delete namespace stackable
